<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <link rel="icon" href="../images/Phluowise_Business_icon.svg" type="image/x-icon">
    <title>Template Page</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.15.3/css/all.min.css" rel="stylesheet" />
    <!-- Add Alpine.js (if not already included) -->
    <script src="https://cdn.jsdelivr.net/npm/alpinejs@3.x.x/dist/cdn.min.js" defer></script>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@100..900&display=swap" rel="stylesheet">
    <script src="https://cdn.jsdelivr.net/npm/sweetalert2@11"></script>



  <script>
    // const isLoggedIn = localStorage.getItem("isLoggedIn");
  
    // if (!isLoggedIn) {
    //   window.location.href = "user-signin.html"; // Redirect to login if not authenticated
    // }
  </script>
</head>

<body class="bg-black text-white">
    <style>
        body {
            font-family: 'Inter', sans-serif;
        }
    </style>
    <style>
        .glassmorphism {
            background: rgba(255, 255, 255, 0.1);
            -webkit-backdrop-filter: blur(10px);
            backdrop-filter: blur(10px);
            border: 1px solid rgba(255, 255, 255, 0.2);
        }
    </style>
    <div class="flex">
        <!-- Sidebar -->
        <div id="sidebar">
            <div class="w-64 h-screen p-4 pr-0 flex-col bg-[#212121] flex fixed"  >
                <div class="text-center mb-8">
                    <img src="../images/phluowise_logo.svg" alt="">
                </div>
                <div class="space-y-8 text-white">
                    <div>
                        <h2 class="text-gray-500 text-xs mb-2">OVERVIEW</h2>
                        <ul class="space-y-4">
                            <li>
                                <a href="account.html" class="flex items-center space-x-2 text-white hover:text-blue-400">
                                    <img src="../images/home.svg" alt="Home">
                                    <span>Home</span>
                                </a>
                            </li>
                            <li class="relative">
                                <a href="#" class="menu-item flex items-center space-x-2 text-blue-500 hover:text-blue-400">
                                    <img src="../images/carbon_workspace.svg" alt="Workspace">
                                    <span>Workspace</span>
                                </a>
                                <div class="selection-indicator w-1.5 h-12 bg-blue-500 absolute right-0 top-1/2 -translate-y-1/2 rounded-tl-sm rounded-bl-sm"></div>
                            </li>
                            <li>
                                <a href="#" class="flex items-center space-x-2 text-gray-400 hover:text-blue-400">
                                    <img src="../images/arcticons_game-plugins.svg" alt="Plugins">
                                    <span>Plugins</span>
                                </a>
                            </li>
                            <li>
                                <a href="#" class="flex items-center space-x-2 text-gray-400 hover:text-blue-400">
                                    <img src="../images/fluent_people-community-24-regular.svg" alt="Community">
                                    <span>Community</span>
                                </a>
                            </li>
                        </ul>
                    </div>



                </div>
                <footer class="mt-auto ">
                    <div class="text-blue-600">
                      <p class="text-sm">This is a Beta version (1.0.00)</p>
                    </div>
                    <div class="mt-2">
                      <a href="#" class="text-gray-400 text-sm hover:text-blue-400 underline">
                        Learn more about Phluowise
                      </a>
                    </div>
                  </footer>
            </div>


        </div>
        <!-- Main Content -->
        <div class="ml-64 p-5 w-full text-white">
            <!-- Top Bar -->
           <!-- TOPBAR PLACEHOLDER -->
<div id="topbar">
    <script>
      fetch("topbar.html")
        .then(response => response.text())
        .then(data => {
          document.getElementById("topbar").innerHTML = data;
  
          // Attach logout handler after topbar is loaded
          const logoutBtn = document.querySelector(".logout-btn");
          if (logoutBtn) logoutBtn.addEventListener("click", confirmLogout);
        });
  
      // Global logout function
      function confirmLogout(e) {
        e.preventDefault(); // Prevent <a href="#"> default action
        Swal.fire({
          title: 'Log out?',
          text: "You'll be signed out!",
          icon: 'warning',
          showCancelButton: true,
          confirmButtonText: 'Yes, log out'
        }).then((result) => {
          if (result.isConfirmed) {
            // Clear only necessary login-related storage
            localStorage.removeItem("authToken");           // Company login session
            localStorage.removeItem("loginToken");          // Temp login token for OTP
            localStorage.removeItem("otpPurpose");          // Used for knowing OTP flow
            localStorage.removeItem("otpToken");            // OTP token (login/forgot)
            localStorage.removeItem("otpEmail");            // Email used in OTP
            localStorage.removeItem("loggedInCompany");     // Company info after login
            localStorage.removeItem("resendTimeout");       // OTP resend timer
  
            // Redirect to login page
            window.location.href = "user-signin.html";
          }
        });
      }
    </script>
  </div>
  
            <!-- Main Content Area -->
            <div class="container mx-auto p-4">
              <!-- Dashboard Header -->
              <div class="flex justify-between items-center mb-6">
                <h1 class="text-2xl font-bold">Dashboard Overview</h1>
                <div class="text-sm text-gray-400">
                  <span id="lastUpdated">Last updated: Just now</span>
                </div>
              </div>

              <!-- Summary Cards -->
              <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-6 mb-8">
                <!-- Total Branches Card -->
                <div class="bg-gradient-to-br from-blue-600 to-blue-800 rounded-xl p-6 text-white">
                  <div class="flex justify-between items-start">
                    <div>
                      <p class="text-sm font-medium text-blue-100">Total Branches</p>
                      <h3 id="totalBranches" class="text-3xl font-bold mt-1">0</h3>
                      <p class="text-xs text-blue-200 mt-2"><span id="branchChange" class="font-semibold">0%</span> from last month</p>
                    </div>
                    <div class="bg-blue-500/20 p-3 rounded-lg">
                      <i class="fas fa-code-branch text-xl"></i>
                    </div>
                  </div>
                </div>

                <!-- Active Orders Card -->
                <div class="bg-gradient-to-br from-green-600 to-green-800 rounded-xl p-6 text-white">
                  <div class="flex justify-between items-start">
                    <div>
                      <p class="text-sm font-medium text-green-100">Active Orders</p>
                      <h3 id="activeOrders" class="text-3xl font-bold mt-1">0</h3>
                      <p class="text-xs text-green-200 mt-2"><span id="ordersChange" class="font-semibold">0%</span> from yesterday</p>
                    </div>
                    <div class="bg-green-500/20 p-3 rounded-lg">
                      <i class="fas fa-shopping-cart text-xl"></i>
                    </div>
                  </div>
                </div>

                <!-- Total Revenue Card -->
                <div class="bg-gradient-to-br from-purple-600 to-purple-800 rounded-xl p-6 text-white">
                  <div class="flex justify-between items-start">
                    <div>
                      <p class="text-sm font-medium text-purple-100">Total Revenue</p>
                      <h3 id="totalRevenue" class="text-3xl font-bold mt-1">$0</h3>
                      <p class="text-xs text-purple-200 mt-2"><span id="revenueChange" class="font-semibold">0%</span> from last month</p>
                    </div>
                    <div class="bg-purple-500/20 p-3 rounded-lg">
                      <i class="fas fa-chart-line text-xl"></i>
                    </div>
                  </div>
                </div>

                <!-- Customer Satisfaction -->
                <div class="bg-gradient-to-br from-amber-600 to-amber-800 rounded-xl p-6 text-white">
                  <div class="flex justify-between items-start">
                    <div>
                      <p class="text-sm font-medium text-amber-100">Satisfaction</p>
                      <h3 id="satisfactionScore" class="text-3xl font-bold mt-1">0%</h3>
                      <p class="text-xs text-amber-200 mt-2"><span id="satisfactionChange" class="font-semibold">0%</span> from last month</p>
                    </div>
                    <div class="bg-amber-500/20 p-3 rounded-lg">
                      <i class="fas fa-star text-xl"></i>
                    </div>
                  </div>
                </div>
              </div>

              <!-- Main Content Grid -->
              <div class="grid grid-cols-1 lg:grid-cols-3 gap-6">
                <!-- Company and Branches Cards -->
                <div class="lg:col-span-1 space-y-6">
                  <!-- Main Company Card -->
                  <div id="companyCard" class="bg-white/10 border border-white/20 rounded-2xl p-6 shadow-lg">
                    <div class="flex flex-col items-center text-center">
                      <img id="companyLogo" src="../images/phluowise_logo.svg" class="w-16 h-16 object-cover rounded-full mb-3 border-4 border-blue-600" alt="Company Logo">
                      <h2 id="companyNameDisplay" class="text-xl font-bold mb-1">Company Name</h2>
                      <p class="text-sm text-gray-400 mb-4" id="companyDescDisplay">Loading company info...</p>
                      <a href="profile.html" class="w-full px-4 py-2 bg-blue-600 hover:bg-blue-700 rounded-lg text-white font-medium text-sm transition-colors">
                        Manage Company Profile
                      </a>
                    </div>
                  </div>

                  <!-- Branches Shortcut Card -->
                  <div class="bg-white/10 border border-white/20 rounded-2xl p-6 shadow-lg">
                    <div class="flex items-center justify-between mb-4">
                      <h3 class="font-semibold">Branches</h3>
                      <span id="branchCount" class="text-sm text-gray-400">0 active</span>
                    </div>
                    <div id="branchesList" class="space-y-3 max-h-60 overflow-y-auto pr-2">
                      <!-- Branches will be listed here -->
                      <div class="text-center py-4 text-gray-500">
                        <i class="fas fa-spinner fa-spin mr-2"></i> Loading branches...
                      </div>
                    </div>
                    <a href="branches.html" class="mt-4 block w-full text-center px-4 py-2 bg-green-600 hover:bg-green-700 rounded-lg text-white font-medium text-sm transition-colors">
                      View All Branches
                    </a>
                  </div>
                </div>

                <!-- Branch Performance Table -->
                <div class="lg:col-span-2">
                  <div class="bg-white/10 border border-white/20 rounded-2xl p-6 shadow-lg">
                    <div class="flex justify-between items-center mb-6">
                      <h3 class="font-semibold">Branch Performance</h3>
                      <div class="flex space-x-2">
                        <button id="refreshBtn" class="p-2 rounded-lg hover:bg-white/10 transition-colors" title="Refresh Data">
                          <i class="fas fa-sync-alt text-sm"></i>
                        </button>
                        <select id="timeRange" class="bg-white/10 border border-white/20 rounded-lg px-3 py-1 text-sm focus:outline-none focus:ring-2 focus:ring-blue-600">
                          <option value="7">Last 7 Days</option>
                          <option value="30" selected>Last 30 Days</option>
                          <option value="90">Last Quarter</option>
                          <option value="365">Last Year</option>
                        </select>
                      </div>
                    </div>
                    <div class="overflow-x-auto">
                      <table class="w-full">
                        <thead>
                          <tr class="text-left text-sm text-gray-400 border-b border-white/10">
                            <th class="pb-3 font-medium">Branch</th>
                            <th class="pb-3 font-medium text-right">Orders</th>
                            <th class="pb-3 font-medium text-right">Revenue</th>
                            <th class="pb-3 font-medium text-right">Rating</th>
                            <th class="pb-3 font-medium text-right">Status</th>
                          </tr>
                        </thead>
                        <tbody id="branchPerformanceBody" class="divide-y divide-white/5">
                          <tr>
                            <td colspan="5" class="py-4 text-center text-gray-500">
                              <i class="fas fa-spinner fa-spin mr-2"></i> Loading branch data...
                            </td>
                          </tr>
                        </tbody>
                      </table>
                    </div>
                  </div>
                </div>
              <script>
                // Utility: Get user type
                function getUserType() {
                  if (localStorage.getItem('loggedInCompany')) return 'admin';
                  if (localStorage.getItem('loggedInBranch')) return 'branch';
                  return null;
                }

                // Format currency
                function formatCurrency(amount) {
                  return new Intl.NumberFormat('en-US', {
                    style: 'currency',
                    currency: 'USD',
                    minimumFractionDigits: 0,
                    maximumFractionDigits: 0
                  }).format(amount);
                }

                // Format date
                function formatDate(date) {
                  return new Date(date).toLocaleDateString('en-US', {
                    year: 'numeric',
                    month: 'short',
                    day: 'numeric',
                    hour: '2-digit',
                    minute: '2-digit'
                  });
                }

                // Calculate percentage change
                function calculateChange(current, previous) {
                  if (previous === 0) return 100;
                  return Math.round(((current - previous) / previous) * 100);
                }

                // Update last updated time
                function updateLastUpdated() {
                  document.getElementById('lastUpdated').textContent = `Last updated: ${new Date().toLocaleTimeString()}`;
                }

                // Utility: Render company card
                async function renderCompanyCard(userType) {
                  try {
                    const data = JSON.parse(localStorage.getItem('companyProfile')) || {};
                    document.getElementById('companyNameDisplay').textContent = data.companyName || 'Company Name';
                    document.getElementById('companyDescDisplay').textContent = data.description || 'Manage your company profile and settings';
                    if (data.profileImage) {
                      document.getElementById('companyLogo').src = data.profileImage;
                    }
                    
                    // Only show manage button for admin
                    const manageBtn = document.querySelector('#companyCard a');
                    if (userType === 'admin') {
                      manageBtn.classList.remove('hidden');
                    } else {
                      manageBtn.classList.add('hidden');
                    }
                  } catch (error) {
                    console.error('Error rendering company card:', error);
                  }
                }

                // Fetch branch metrics
                async function fetchBranchMetrics(branchId) {
                  try {
                    // This is a mock implementation - replace with actual API calls
                    await new Promise(resolve => setTimeout(resolve, 300)); // Simulate API delay
                    
                    // Mock data - replace with actual API response
                    return {
                      id: branchId,
                      orders: {
                        total: Math.floor(Math.random() * 500) + 100,
                        previous: Math.floor(Math.random() * 400) + 50,
                        status: ['completed', 'pending', 'cancelled'][Math.floor(Math.random() * 3)]
                      },
                      revenue: {
                        total: Math.floor(Math.random() * 50000) + 10000,
                        previous: Math.floor(Math.random() * 40000) + 5000
                      },
                      rating: (Math.random() * 2 + 3).toFixed(1),
                      ratingChange: (Math.random() * 20 - 5).toFixed(1)
                    };
                  } catch (error) {
                    console.error('Error fetching branch metrics:', error);
                    return null;
                  }
                }

                // Render branch performance table
                async function renderBranchPerformance(branches) {
                  const tbody = document.getElementById('branchPerformanceBody');
                  if (!branches || branches.length === 0) {
                    tbody.innerHTML = `
                      <tr>
                        <td colspan="5" class="py-4 text-center text-gray-500">
                          No branches found
                        </td>
                      </tr>`;
                    return;
                  }

                  // Clear loading state
                  tbody.innerHTML = '';
                  
                  // Add loading placeholders
                  branches.forEach(branch => {
                    const row = document.createElement('tr');
                    row.className = 'hover:bg-white/5 transition-colors';
                    row.innerHTML = `
                      <td class="py-3">
                        <div class="flex items-center">
                          <div class="h-8 w-8 rounded-full bg-gray-700 flex items-center justify-center mr-3">
                            <i class="fas fa-store text-xs"></i>
                          </div>
                          <div>
                            <div class="font-medium">${branch.branchName || 'Unnamed Branch'}</div>
                            <div class="text-xs text-gray-400">${branch.location || 'Location not set'}</div>
                          </div>
                        </div>
                      </td>
                      <td class="py-3 text-right">
                        <div class="h-4 bg-gray-700 rounded animate-pulse w-3/4 ml-auto"></div>
                      </td>
                      <td class="py-3 text-right">
                        <div class="h-4 bg-gray-700 rounded animate-pulse w-2/3 ml-auto"></div>
                      </td>
                      <td class="py-3 text-right">
                        <div class="h-4 bg-gray-700 rounded animate-pulse w-1/2 ml-auto"></div>
                      </td>
                      <td class="py-3 text-right">
                        <div class="h-2 w-2 rounded-full bg-gray-600 ml-auto"></div>
                      </td>
                    `;
                    tbody.appendChild(row);
                  });

                  // Fetch metrics for each branch and update the table
                  const timeRange = document.getElementById('timeRange').value;
                  const metricsPromises = branches.map(branch => fetchBranchMetrics(branch.id));
                  const allMetrics = await Promise.all(metricsPromises);
                  
                  // Calculate totals for summary cards
                  let totalOrders = 0;
                  let totalRevenue = 0;
                  let totalRating = 0;
                  let activeBranches = 0;

                  // Update table with actual data
                  tbody.innerHTML = '';
                  branches.forEach((branch, index) => {
                    const metrics = allMetrics[index];
                    if (!metrics) return;

                    const ordersChange = calculateChange(metrics.orders.total, metrics.orders.previous);
                    const revenueChange = calculateChange(metrics.revenue.total, metrics.revenue.previous);
                    
                    totalOrders += metrics.orders.total;
                    totalRevenue += metrics.revenue.total;
                    totalRating += parseFloat(metrics.rating);
                    activeBranches++;

                    const row = document.createElement('tr');
                    row.className = 'hover:bg-white/5 transition-colors';
                    row.innerHTML = `
                      <td class="py-3">
                        <div class="flex items-center">
                          <div class="h-8 w-8 rounded-full bg-blue-600/20 flex items-center justify-center mr-3">
                            <i class="fas fa-store text-blue-400 text-xs"></i>
                          </div>
                          <div>
                            <div class="font-medium">${branch.branchName || 'Unnamed Branch'}</div>
                            <div class="text-xs text-gray-400">${branch.location || 'Location not set'}</div>
                          </div>
                        </div>
                      </td>
                      <td class="py-3 text-right">
                        <div>${metrics.orders.total.toLocaleString()}</div>
                        <div class="text-xs ${ordersChange >= 0 ? 'text-green-400' : 'text-red-400'}">
                          ${ordersChange >= 0 ? '↑' : '↓'} ${Math.abs(ordersChange)}%
                        </div>
                      </td>
                      <td class="py-3 text-right">
                        <div>${formatCurrency(metrics.revenue.total)}</div>
                        <div class="text-xs ${revenueChange >= 0 ? 'text-green-400' : 'text-red-400'}">
                          ${revenueChange >= 0 ? '↑' : '↓'} ${Math.abs(revenueChange)}%
                        </div>
                      </td>
                      <td class="py-3 text-right">
                        <div class="flex items-center justify-end">
                          <span class="text-yellow-400 mr-1">${metrics.rating}</span>
                          <i class="fas fa-star text-yellow-400 text-xs"></i>
                          <span class="text-xs ml-1 ${metrics.ratingChange >= 0 ? 'text-green-400' : 'text-red-400'}">
                            (${metrics.ratingChange >= 0 ? '+' : ''}${metrics.ratingChange}%)
                          </span>
                        </div>
                      </td>
                      <td class="py-3 text-right">
                        <span class="inline-flex items-center px-2.5 py-0.5 rounded-full text-xs font-medium ${metrics.orders.status === 'completed' ? 'bg-green-100 text-green-800' : metrics.orders.status === 'pending' ? 'bg-yellow-100 text-yellow-800' : 'bg-red-100 text-red-800'}">
                          ${metrics.orders.status.charAt(0).toUpperCase() + metrics.orders.status.slice(1)}
                        </span>
                      </td>
                    `;
                    tbody.appendChild(row);
                  });

                  // Update summary cards
                  const avgRating = activeBranches > 0 ? (totalRating / activeBranches).toFixed(1) : 0;
                  const prevMonthOrders = Math.floor(totalOrders * 0.8);
                  const prevMonthRevenue = Math.floor(totalRevenue * 0.85);
                  const prevMonthRating = Math.max(0, parseFloat(avgRating) - 0.3).toFixed(1);
                  
                  document.getElementById('totalBranches').textContent = activeBranches;
                  document.getElementById('activeOrders').textContent = totalOrders.toLocaleString();
                  document.getElementById('totalRevenue').textContent = formatCurrency(totalRevenue);
                  document.getElementById('satisfactionScore').textContent = `${avgRating}/5.0`;
                  
                  document.getElementById('branchChange').textContent = '0%';
                  document.getElementById('ordersChange').textContent = `${calculateChange(totalOrders, prevMonthOrders)}%`;
                  document.getElementById('revenueChange').textContent = `${calculateChange(totalRevenue, prevMonthRevenue)}%`;
                  document.getElementById('satisfactionChange').textContent = `${((avgRating - prevMonthRating) / prevMonthRating * 100).toFixed(1)}%`;
                  
                  document.getElementById('branchCount').textContent = `${activeBranches} ${activeBranches === 1 ? 'branch' : 'branches'}`;
                }

                // Utility: Render branches list
                async function renderBranchesList(branches) {
                  const container = document.getElementById('branchesList');
                  if (!branches || branches.length === 0) {
                    container.innerHTML = '<div class="text-center py-4 text-gray-500">No branches found</div>';
                    return;
                  }

                  container.innerHTML = '';
                  const fragment = document.createDocumentFragment();
                  
                  // Show only the first 5 branches with a "View All" link
                  const displayBranches = branches.slice(0, 5);
                  
                  displayBranches.forEach(branch => {
                    const branchElement = document.createElement('div');
                    branchElement.className = 'flex items-center justify-between p-2 hover:bg-white/5 rounded-lg transition-colors';
                    branchElement.innerHTML = `
                      <div class="flex items-center">
                        <div class="h-8 w-8 rounded-full bg-blue-600/20 flex items-center justify-center mr-3">
                          <i class="fas fa-store text-blue-400 text-xs"></i>
                        </div>
                        <div>
                          <div class="text-sm font-medium">${branch.branchName || 'Unnamed Branch'}</div>
                          <div class="text-xs text-gray-400">${branch.location || 'Location not set'}</div>
                        </div>
                      </div>
                      <span class="text-xs px-2 py-1 rounded-full ${branch.isActive ? 'bg-green-100 text-green-800' : 'bg-gray-100 text-gray-800'}">
                        ${branch.isActive ? 'Active' : 'Inactive'}
                      </span>
                    `;
                    fragment.appendChild(branchElement);
                  });
                  
                  // Add "View All" link if there are more than 5 branches
                  if (branches.length > 5) {
                    const viewAll = document.createElement('div');
                    viewAll.className = 'text-center mt-2';
                    viewAll.innerHTML = `
                      <a href="branches.html" class="text-blue-400 hover:text-blue-300 text-sm font-medium">
                        View all ${branches.length} branches
                      </a>
                    `;
                    fragment.appendChild(viewAll);
                  }
                  
                  container.appendChild(fragment);
                }

                // Utility: Render branches
                async function renderBranches(userType) {
                  // Show loading state
                  const branchesList = document.getElementById('branchesList');
                  branchesList.innerHTML = `
                    <div class="text-center py-4 text-gray-500">
                      <i class="fas fa-spinner fa-spin mr-2"></i> Loading branches...
                    </div>
                  `;
                  
                  // Fetch branches from API
                  let branches = [];
                  try {
                    const token = localStorage.getItem('authToken');
                    const loggedInCompanyData = localStorage.getItem('loggedInCompany');
                    const companyData = loggedInCompanyData ? JSON.parse(loggedInCompanyData) : null;
                    const companyId = companyData?.id;
                    
                    if (!companyId || !token) {
                      throw new Error('Not authenticated');
                    }
                    
                    const response = await fetch(`https://phluowise.azurewebsites.net/api/Branch/GetAllByCompanyId?companyId=${companyId}`, {
                      headers: { 
                        'Authorization': `Bearer ${token}`,
                        'Content-Type': 'application/json'
                      }
                    });
                    
                    if (!response.ok) {
                      throw new Error(`API request failed with status ${response.status}`);
                    }
                    
                    branches = await response.json();
                    
                    // Add isActive flag to each branch (mock implementation)
                    branches = branches.map(branch => ({
                      ...branch,
                      isActive: Math.random() > 0.2 // 80% chance of being active
                    }));
                    
                    // Update branch list
                    await renderBranchesList(branches);
                    
                    // Update branch performance table
                    if (userType === 'admin') {
                      await renderBranchPerformance(branches);
                    }
                    
                  } catch (error) {
                    console.error('Error fetching branches:', error);
                    branchesList.innerHTML = `
                      <div class="text-center py-4 text-red-400">
                        <i class="fas fa-exclamation-circle mr-2"></i>
                        Failed to load branches. Please try again later.
                      </div>
                    `;
                  }
                  
                  return branches;
                }

                // Restrict navigation for branch users
                function restrictBranchNavigation(userType) {
                  if (userType === 'branch') {
                    // Disable profile.html link and manage buttons
                    document.querySelectorAll('a[href="profile.html"]').forEach(a => { a.onclick = e => { e.preventDefault(); Swal.fire('Access Denied', 'Branches cannot edit company profile.', 'warning'); }; });
                    document.querySelectorAll('a[href*="create_branch"]').forEach(a => { a.onclick = e => { e.preventDefault(); Swal.fire('Access Denied', 'Branches cannot manage branches.', 'warning'); }; });
                  }
                }

                // Initialize the dashboard
                async function initializeDashboard() {
                  updateLastUpdated();
                  
                  const userType = getUserType();
                  if (!userType) {
                    window.location.href = 'user-signin.html';
                    return;
                  }
                  
                  // Render company card
                  await renderCompanyCard(userType);
                  
                  // Render branches and metrics
                  await renderBranches(userType);
                  
                  // Add event listeners
                  document.getElementById('refreshBtn')?.addEventListener('click', async () => {
                    await renderBranches(userType);
                    updateLastUpdated();
                  });
                  
                  document.getElementById('timeRange')?.addEventListener('change', async () => {
                    await renderBranches(userType);
                    updateLastUpdated();
                  });
                }
                
                // Start the dashboard when the page loads
                document.addEventListener('DOMContentLoaded', () => {
                  initializeDashboard().then(() => {
                    const userType = getUserType();
                    if (userType) {
                      restrictBranchNavigation(userType);
                    }
                  });
                });
              </script>
                            <i class="fas fa-link text-gray-400"></i>
                        </div>
                    </div>
                    <div class="glassmorphism p-4 rounded-lg relative">
                        <span class="absolute top-2 right-2 bg-gray-700 text-white py-1 px-2 rounded">Branch</span>
                        <div class="mt-8">
                            <p class="text-lg font-semibold">Admin name</p>
                            <p class="text-gray-400">Location</p>
                        </div>
                        <div class="absolute bottom-2 right-2">
                            <i class="fas fa-link text-blue-500"></i>
                        </div>
                    </div>
                </div>

            </div>
            <!-- end of content -->
        </div>
    </div>
    </div>
</body>

</html>