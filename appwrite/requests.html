<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <link rel="icon" href="../images/Phluowise_Business_icon.svg" type="image/x-icon">
    <title>Requests - Phluowise</title>

    <!-- Tailwind + Dependencies -->
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.15.3/css/all.min.css" rel="stylesheet" />
    <script src="https://cdn.jsdelivr.net/npm/alpinejs@3.x.x/dist/cdn.min.js" defer></script>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@100..900&display=swap" rel="stylesheet">
    <script src="https://cdn.jsdelivr.net/npm/sweetalert2@11"></script>

    <style>
        body {
            font-family: 'Inter', sans-serif;
        }

        .glassmorphism {
            background: #212121;
            backdrop-filter: blur(10px);
            -webkit-backdrop-filter: blur(10px);
            border: 1px solid rgba(255, 255, 255, 0.05);
            border-radius: 10px;
        }

        .tab-button {
            transition: all 0.3s ease;
        }

        .tab-button:hover {
            color: white !important;
        }

        .order-card {
            transition: transform 0.3s ease, box-shadow 0.3s ease;
        }

        .order-card:hover {
            transform: translateY(-2px);
            box-shadow: 0 10px 25px rgba(0, 0, 0, 0.3);
        }

        .avatar-placeholder {
            background: linear-gradient(135deg, #3f3f46, #52525b);
            display: flex;
            align-items: center;
            justify-content: center;
            color: #a1a1aa;
            font-weight: bold;
        }

        .modal {
            transition: opacity 0.3s ease, visibility 0.3s ease;
            z-index: 1000;
        }

        .modal.hidden {
            opacity: 0;
            visibility: hidden;
        }

        .products-slider {
            display: flex;
            overflow-x: auto;
            scroll-snap-type: x mandatory;
            gap: 1rem;
            padding-bottom: 1rem;
        }

        .product-slide {
            scroll-snap-align: start;
            min-width: 100%;
            flex-shrink: 0;
            transition: transform 0.5s ease;
        }

        .products-slider::-webkit-scrollbar {
            height: 6px;
        }

        .products-slider::-webkit-scrollbar-track {
            background: #374151;
            border-radius: 10px;
        }

        .products-slider::-webkit-scrollbar-thumb {
            background: #4B5563;
            border-radius: 10px;
        }

        .loading-spinner {
            border: 3px solid #374151;
            border-top: 3px solid #3b82f6;
            border-radius: 50%;
            width: 40px;
            height: 40px;
            animation: spin 1s linear infinite;
        }

        @keyframes spin {
            0% {
                transform: rotate(0deg);
            }

            100% {
                transform: rotate(360deg);
            }
        }

        .card-hover {
            transition: all 0.3s ease;
        }

        .card-hover:hover {
            transform: translateY(-2px);
            box-shadow: 0 10px 25px rgba(0, 0, 0, 0.3);
        }
    </style>
</head>

<body class="bg-black text-white">
    <div class="flex">
        <!-- Sidebar -->
        <div id="sidebar"></div>
        <script>
            fetch("sidebar.html")
                .then(response => response.text())
                .then(data => {
                    document.getElementById("sidebar").innerHTML = data;
                    highlightActivePage();
                    // Apply branch context to sidebar links
                    (function applyBranchContextToSidebar() {
                        try {
                            const params = new URLSearchParams(window.location.search);
                            const branchId = params.get("branchId") || localStorage.getItem("impersonateBranchId");
                            const as = params.get("as") || localStorage.getItem("impersonateMode");
                            if (!branchId) return;
                            localStorage.setItem("impersonateBranchId", String(branchId));
                            if (as) localStorage.setItem("impersonateMode", String(as));
                            document.querySelectorAll('#sidebar a[href$=".html"]').forEach(a => {
                                const href = a.getAttribute('href');
                                if (!href || href.startsWith('http')) return;
                                const [base, query] = href.split('?');
                                const sp = new URLSearchParams(query || "");
                                sp.set('branchId', branchId);
                                if (as) sp.set('as', as);
                                a.setAttribute('href', `${base}?${sp.toString()}`);
                            });
                        } catch (e) { console.error(e); }
                    })();
                });

            function highlightActivePage() {
                const currentPage = window.location.pathname.split("/").pop().replace(".html", "").toLowerCase();
                document.querySelectorAll(".menu-item").forEach(item => {
                    const page = item.getAttribute("data-page");
                    if (page === currentPage || page === "requests") {
                        item.classList.add("text-blue-400", "font-bold");
                        item.querySelector(".selection-indicator")?.classList.remove("hidden");
                    }
                });
            }
        </script>

        <!-- Main Content -->
        <div class="ml-64 p-5 w-full text-white">
            <!-- Top Bar -->
            <div id="topbar"></div>
            <script>
                fetch("topbar.html")
                    .then((r) => r.text())
                    .then((html) => {
                        const container = document.getElementById("topbar");
                        container.innerHTML = html;
                        // Execute scripts found in the injected markup
                        container.querySelectorAll("script").forEach((oldScript) => {
                            const s = document.createElement("script");
                            if (oldScript.src) {
                                s.src = oldScript.src;
                                s.async = false;
                            } else {
                                s.textContent = oldScript.textContent;
                            }
                            document.body.appendChild(s);
                        });
                    });
            </script>

            <!-- Main Content Area -->
            <div class="container mx-auto mt-10 p-4">
                <!-- Page Header -->
                <div class="mb-8 flex justify-between items-center">
                    <div>
                        <h1 class="text-3xl font-bold text-white">Order Requests</h1>
                        <p class="text-gray-400">Manage and track customer order requests</p>
                    </div>
                    <div>
                        <a href="test-order-creation/test-orders.html"
                            class="border border-blue-600 hover:bg-blue-600 text-blue-600 hover:text-white px-6 py-3 rounded-lg font-medium inline-flex items-center">
                            <i class="fas fa-flask mr-2"></i>Test Orders
                        </a>
                    </div>
                </div>

                <!-- Loading State -->
                <div id="loading-state" class="flex justify-center items-center py-20">
                    <div class="loading-spinner"></div>
                    <span class="ml-4 text-gray-400">Loading orders...</span>
                </div>

                <!-- Error State -->
                <div id="error-state" class="hidden glassmorphism p-8 text-center">
                    <div class="text-red-400 mb-4">
                        <i class="fas fa-exclamation-triangle text-4xl"></i>
                    </div>
                    <h3 class="text-xl font-semibold mb-2">Failed to Load Orders</h3>
                    <p class="text-gray-400 mb-4" id="error-message">Unable to fetch order data</p>
                    <button id="retry-btn" class="bg-blue-600 hover:bg-blue-700 text-white px-6 py-2 rounded-lg">
                        <i class="fas fa-redo mr-2"></i>Retry
                    </button>
                </div>

                <!-- Main Content -->
                <div id="main-content" class="hidden">
                    <!-- Tab Navigation -->
                    <div class="flex border-b border-gray-700 mb-6">
                        <button id="all-tab"
                            class="tab-button active py-3 px-6 font-medium border-b-2 border-blue-500 text-white">
                            All Orders <span id="all-count"
                                class="ml-2 bg-gray-700 px-2 py-1 rounded-full text-xs">0</span>
                        </button>
                        <button id="pending-tab" class="tab-button py-3 px-6 text-gray-400 font-medium">
                            Pending <span id="pending-count"
                                class="ml-2 bg-gray-700 px-2 py-1 rounded-full text-xs">0</span>
                        </button>
                        <button id="accepted-tab" class="tab-button py-3 px-6 text-gray-400 font-medium">
                            Accepted <span id="accepted-count"
                                class="ml-2 bg-gray-700 px-2 py-1 rounded-full text-xs">0</span>
                        </button>
                        <button id="denied-tab" class="tab-button py-3 px-6 text-gray-400 font-medium">
                            Denied <span id="denied-count"
                                class="ml-2 bg-gray-700 px-2 py-1 rounded-full text-xs">0</span>
                        </button>
                    </div>

                    <!-- Tab Content -->
                    <div class="tab-content">
                        <!-- All Orders Tab (Default) -->
                        <div id="all-content" class="tab-pane active">
                            <div class="grid grid-cols-1 md:grid-cols-2 xl:grid-cols-3 gap-6" id="all-container">
                                <!-- Orders will be dynamically populated here -->
                            </div>
                        </div>

                        <!-- Pending Tab -->
                        <div id="pending-content" class="tab-pane hidden">
                            <div class="grid grid-cols-1 md:grid-cols-2 xl:grid-cols-3 gap-6" id="pending-container">
                                <!-- Pending orders will appear here -->
                            </div>
                        </div>

                        <!-- Accepted Tab -->
                        <div id="accepted-content" class="tab-pane hidden">
                            <div class="grid grid-cols-1 md:grid-cols-2 xl:grid-cols-3 gap-6" id="accepted-container">
                                <!-- Accepted orders will appear here -->
                            </div>
                        </div>

                        <!-- Denied Tab -->
                        <div id="denied-content" class="tab-pane hidden">
                            <div class="grid grid-cols-1 md:grid-cols-2 xl:grid-cols-3 gap-6" id="denied-container">
                                <!-- Denied orders will appear here -->
                            </div>
                        </div>
                    </div>

                    <!-- Empty State -->
                    <div id="empty-state" class="hidden text-center py-20">
                        <div class="text-gray-500 mb-4">
                            <i class="fas fa-inbox text-6xl"></i>
                        </div>
                        <h3 class="text-xl font-semibold mb-2">No Orders Found</h3>
                        <p class="text-gray-400">There are no orders to display at the moment.</p>
                    </div>
                </div>
            </div>

            <!-- Order Details Modal -->
            <div id="order-modal"
                class="fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center modal hidden">
                <div
                    class="bg-gray-800 text-gray-300 rounded-lg shadow-xl w-full max-w-2xl mx-4 max-h-[90vh] flex flex-col">
                    <!-- Header -->
                    <div class="border-b border-gray-700 p-6">
                        <div class="flex justify-between items-center">
                            <h2 class="text-2xl font-semibold text-white">Order Details</h2>
                            <button id="close-modal-btn" class="text-gray-400 hover:text-white">
                                <i class="fas fa-times text-xl"></i>
                            </button>
                        </div>
                    </div>

                    <!-- Scrollable Content -->
                    <div class="overflow-y-auto flex-1 p-6">
                        <!-- Customer Info -->
                        <div class="mb-6">
                            <h3 class="font-semibold mb-3 text-white">Customer Information</h3>
                            <div class="glassmorphism p-4">
                                <div class="flex items-center mb-3">
                                    <div
                                        class="w-12 h-12 bg-gradient-to-r from-blue-500 to-purple-600 rounded-full flex items-center justify-center mr-4">
                                        <span id="customer-avatar" class="text-white font-bold text-lg"></span>
                                    </div>
                                    <div>
                                        <p class="font-semibold text-white" id="customer-name">Customer Name</p>
                                        <p class="text-gray-400 text-sm" id="customer-location">Location</p>
                                    </div>
                                </div>
                                <div class="grid grid-cols-2 gap-4 text-sm">
                                    <div>
                                        <span class="text-gray-400">Order Date:</span>
                                        <span class="text-white ml-2" id="order-date">-</span>
                                    </div>
                                    <div>
                                        <span class="text-gray-400">Order Time:</span>
                                        <span class="text-white ml-2" id="order-time">-</span>
                                    </div>
                                </div>
                            </div>
                        </div>

                        <!-- Products -->
                        <div class="mb-6">
                            <h3 class="font-semibold mb-3 text-white">Products</h3>
                            <div id="modal-products" class="space-y-3">
                                <!-- Products will be inserted here -->
                            </div>
                        </div>

                        <!-- Order Summary -->
                        <div class="mb-6">
                            <h3 class="font-semibold mb-3 text-white">Order Summary</h3>
                            <div class="glassmorphism p-4">
                                <div class="flex justify-between items-center text-lg font-semibold">
                                    <span>Total Amount:</span>
                                    <span class="text-green-400" id="modal-total">GH₵ 0.00</span>
                                </div>
                            </div>
                        </div>

                        <!-- Additional Notes -->
                        <div class="mb-6">
                            <h3 class="font-semibold mb-3 text-white">Additional Notes</h3>
                            <div class="glassmorphism p-4">
                                <p class="text-gray-300" id="modal-notes">No additional notes</p>
                            </div>
                        </div>
                    </div>

                    <!-- Footer Actions -->
                    <div class="p-6 flex justify-end space-x-3 border-t border-gray-700">
                        <button id="modal-deny-btn"
                            class="px-6 py-2 bg-red-600 hover:bg-red-700 text-white rounded-lg transition-colors">
                            <i class="fas fa-times mr-2"></i>Deny
                        </button>
                        <button id="modal-accept-btn"
                            class="px-6 py-2 bg-green-600 hover:bg-green-700 text-white rounded-lg transition-colors">
                            <i class="fas fa-check mr-2"></i>Accept
                        </button>
                        <button id="modal-pending-btn"
                            class="px-6 py-2 bg-amber-600 hover:bg-amber-700 text-white rounded-lg transition-colors">
                            <i class="fas fa-clock mr-2"></i>Mark Pending
                        </button>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Scripts -->
    <script type="module" src="js/config.js"></script>
    <script type="module" src="js/authManager.js"></script>
    <script type="module" src="js/requests.js"></script>
</body>

</html>